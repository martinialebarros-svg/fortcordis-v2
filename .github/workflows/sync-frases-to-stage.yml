# Workflow para sincronizar frases do banco local para o stage
name: Sync Frases to Stage

on:
  workflow_dispatch:  # Dispara manualmente

jobs:
  sync-frases:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup SSH
        uses: webfactory/ssh-agent@v0.8.0
        with:
          ssh-private-key: ${{ secrets.VPS_SSH_KEY }}

      - name: Add VPS to known hosts
        run: |
          mkdir -p ~/.ssh
          ssh-keyscan -H ${{ secrets.VPS_HOST }} >> ~/.ssh/known_hosts

      - name: Sync frases.json to Stage
        run: |
          echo "Copiando frases.json para o stage..."
          scp backend/data/frases.json ${{ secrets.VPS_USER }}@${{ secrets.VPS_HOST }}:/var/www/fortcordis-stage/backend/data/frases.json
          
          echo "Verificando arquivo no stage..."
          ssh ${{ secrets.VPS_USER }}@${{ secrets.VPS_HOST }} "cat /var/www/fortcordis-stage/backend/data/frases.json | head -20"
          
          echo "Reiniciando backend do stage..."
          ssh ${{ secrets.VPS_USER }}@${{ secrets.VPS_HOST }} "sudo systemctl restart fortcordis-stage-backend"
          
          echo "âœ… Frases sincronizadas com sucesso!"
